<!DOCTYPE html>
<html lang="en">





<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description" content="Essays about my thoughts and projects">
  <meta name="keywords" content="Technology, Tea, and Keyboards">
  <meta name="author" content="Alexander Stephan">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#f5f5f5">

  <!-- Twitter Tags -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Alexander Stephan">
  <meta name="twitter:description" content="Essays about my thoughts and projects">
  <meta name="twitter:image" content="http://localhost:4000/img/leonids-logo.png">

  <!-- Open Graph Tags -->
  <meta property="og:type" content="blog">
  <meta property="og:url" content="http://localhost:4000">
  <meta property="og:title" content="Alexander Stephan">
  <meta property="og:description" content="Essays about my thoughts and projects">
  <meta property="og:image" content="http://localhost:4000/img/leonids-logo.png">
  <title>Alexander Stephan</title>

  <!-- CSS files -->
  <link rel="stylesheet" href="http://localhost:4000/css/font-awesome.min.css">
  <link rel="stylesheet" href="http://localhost:4000/css/main.css">

  <link rel="canonical" href="http://localhost:4000/">
  <link rel="alternate" type="application/rss+xml" title="Alexander Stephan" href="http://localhost:4000 /feed.xml " />

  <!-- Icons -->
  <!-- 16x16 -->
  <link rel="shortcut icon" href="http://localhost:4000/favicon.ico">
  <!-- 32x32 -->
  <link rel="shortcut icon" href="http://localhost:4000/favicon.png">
</head>


<body>
  <div class="row">
    <div class="col s12 m3">
      <div class="table cover">
        

<div class="cover-card table-cell table-middle">
  
  <a href="http://localhost:4000/">
  <img src="http://localhost:4000/img/avatar.svg" alt="" class="avatar">
  </a>
  
  <a href="http://localhost:4000/" class="author_name">Alexander Stephan</a>
  <span class="author_job">All things Unix</span>
  <span class="author_bio mbm">Enthusiast for various things including UNIX, keyboards & photography. Student at Technical University of Munich</span>
  <!-- <nav class="nav">
    <ul class="nav-list">
      <li class="nav-item">
        <a href="http://localhost:4000/">home</a>
        <span>/</span>
      </li>
       
      <li class="nav-item">
        <a href="http://localhost:4000/archive/">Archive</a>
        
          <span>/</span>
        
      </li>
          
      <li class="nav-item">
        <a href="http://localhost:4000/categories/">Categories</a>
        
          <span>/</span>
        
      </li>
            
      <li class="nav-item">
        <a href="http://localhost:4000/resume/">Resume</a>
        
      </li>
       
    </ul>
  </nav> -->
  
<script type="text/javascript">
  // based on http://stackoverflow.com/a/10300743/280842
  function gen_mail_to_link(hs, subject) {
    var lhs,rhs;
    var p = hs.split('@');
    lhs = p[0];
    rhs = p[1];
    document.write("<a class=\"social-link-item\" target=\"_blank\" href=\"mailto");
    document.write(":" + lhs + "@");
    document.write(rhs + "?subject=" + subject + "\"><i class=\"fa fa-fw fa-envelope\"></i><\/a>");
  }
  
</script>
<div class="social-links">
  <ul>
    
      <li>
      <script>gen_mail_to_link('alexander.stephan@tum.de', 'Hello from website');</script>
      </li>
    
    
    
    
    
    
    
    
    <li><a href="http://github.com/alexanderstephan" class="social-link-item" target="_blank"><i class="fa fa-fw fa-github"></i></a></li>
    
    
    
    
    
    
    
    
    
    
    <li><a href="https://t.me/alexanderstephan" class="social-link-item" target="_blank"><i class="fa fa-fw fa-telegram"></i></a></li>
    <li><a href="https://www.flickr.com/gp/155232150@N04/91o46A" class="social-link-item" target="_blank"><i class="fa fa-fw fa-camera"></i></a></li>
    
    
    
  </ul>
</div>

</div>

      </div>
    </div>
    <div class="col s12 m9">
      <div class="post-listing">
        
<section class="post">
  <header class="post-header">
    <p class="post-meta">
      <span class="post-date">
        22 OCT 2018
      </span>
      
      •
      
        <a class="post-cat" href="http://localhost:4000/categories/#tutorial">tutorial</a>
        
      
      
    </p>
    <h4>
      <a href="http://localhost:4000/articles/2018-10/arch-rice-with-encryption" class="post-title" title="Getting started with Arch Linux">Getting started with Arch Linux</a>
      
    </h4>

    

    </header>

    
    <div class="post-description">
      <p>
        <h2 id="warranty-disclaimer">Warranty Disclaimer:</h2>

<p>I am not responsible for data loss, possible hardware failures, thermonuclear war, or you getting fired because your arch driven atomic plant failed.</p>

<p>If you have any concerns regarding the installation don’t hesitate to do some research on your own to prevent possible failures or bugs.</p>

<p>After booting the arch iso you’ll will have to proceed with the following steps:</p>

<h2 id="prerequisites">Prerequisites:</h2>

<ul>
  <li>A working <a href="https://www.archlinux.org/download/">Arch Linux</a> boot stick</li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo dd </span><span class="k">if</span><span class="o">=</span>&lt;path-to-image.iso&gt; <span class="nv">of</span><span class="o">=</span>/dev/&lt;name-of-usb&gt; <span class="nv">bs</span><span class="o">=</span>4M <span class="nv">status</span><span class="o">=</span>progress
</code></pre></div></div>
<ul>
  <li>A BIOS that is capable of UEFI</li>
</ul>

<h2 id="step-1-prepare-root-file-system">Step 1: Prepare root file system</h2>

<p>Temporarily load your preferred keyboard layout.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>loadkeys de
</code></pre></div></div>

<p>Find out your block device name (<code class="highlighter-rouge">-Sp</code> makes it easier to recognize the drive).</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>lsblk <span class="nt">-Sp</span>
</code></pre></div></div>

<p>For quick formatting use <code class="highlighter-rouge">parted</code>, otherwise you can proceed using <code class="highlighter-rouge">fdisk</code> or <code class="highlighter-rouge">gdisk</code>.</p>

<h3 id="option-1">Option 1:</h3>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>parted
mkpart primary fat32 1MiB 261MiBi <span class="c"># Create EFI system partition</span>
<span class="nb">set </span>1 esp on
mkpart primary ext4 261MiB 100% <span class="c"># Use the rest as ext4</span>
</code></pre></div></div>

<p>This command creates a primary GPT partition on your device and a 260MiB boot partition at the start sector that will later become the EFI partiton for UEFI boot. Then we use the rest of the drive for installing the system. Of course you can tweak these commands according to your specific needs.</p>

<h3 id="option-2">Option 2:</h3>

<p>Type in <code class="highlighter-rouge">fdisk</code> and navigate your way through the dialogs.</p>

<p>Now you can format both partitions you just created to your desired filesystem.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkfs.vfat /dev/&lt;devicename&gt;1
mkfs.ext4 /dev/&lt;devicename&gt;2
</code></pre></div></div>
<p>Mount devices so we can install the base root system on our drive.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir</span> /mnt/boot/
mount /dev/&lt;devicename&gt;2 /mnt
mount /dev/&lt;devicename&gt;1 /mnt/boot/
</code></pre></div></div>
<p>Install the base system including developer tools and patches for Intel processors on target device.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pacstrap /mnt base base-devel intel-ucode
</code></pre></div></div>

<p>Generate <code class="highlighter-rouge">fstab</code> (contains all drives that will be mounted during booting).</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>genfstab <span class="nt">-p</span> /mnt <span class="o">&gt;</span> /mnt/etc/fstab
</code></pre></div></div>

<h2 id="step-2-setup-the-new-root-system">Step 2: Setup the new root system</h2>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>arch-chroot /mnt
</code></pre></div></div>

<p>Now, as we moved to our new system, we can proceed to set all the basic parameters and settings. A good start is to set the host name:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo </span>myhost <span class="o">&gt;</span> /etc/hostname
</code></pre></div></div>

<p>Now we want to set our language. We do that by writing the LANG	variable to <code class="highlighter-rouge">/etc/locale.conf</code>.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo </span><span class="nv">LANG</span><span class="o">=</span>en_US.UTF-8 <span class="o">&gt;</span> /etc/locale.conf
</code></pre></div></div>

<p>Afterwards we want to uncomment the disired entry in <code class="highlighter-rouge">/etc/locale.gen</code> with the editor of your choice, so we can generate it in the next step with the following command:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>locale-gen
</code></pre></div></div>

<p>Now we can set our <a href="https://wiki.archlinux.org/index.php/Linux_console/Keyboard_configuration">keyboard layout</a>. You can check your current layout with <code class="highlighter-rouge">localectl status</code> and to print all options use <code class="highlighter-rouge">localectl list-keymaps</code>.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo </span><span class="nv">KEYMAP</span><span class="o">=</span>de-latin1 <span class="o">&gt;</span> /etc/vconsole.conf
</code></pre></div></div>

<p>In the next step we should set our <a href="https://wiki.archlinux.org/index.php/System_time#Time_zone">time zone</a>. To check out the current time zone use <code class="highlighter-rouge">timedatectl status</code>. To list all time zones use <code class="highlighter-rouge">timedatectl list-timezones</code>. Later we can install an NTP client that automatically syncs the clock over the network.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">ln</span> <span class="nt">-sf</span> /usr/share/zoneinfo/Europe/Berlin /etc/localtime
</code></pre></div></div>

<p>It’s also a good idea to rank the mirros, so we can have faster download speeds when installing software. You can either manually sort them or use <a href="https://wiki.archlinux.org/index.php/Reflector">Reflector</a>. This command for example sorts the 5 most recent mirrors by download speed. If you want only mirrors for your specific country use <code class="highlighter-rouge">-- country</code>.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reflector <span class="nt">--verbose</span> <span class="nt">--latest</span> 50 <span class="nt">--sort</span> rate <span class="nt">--protocol</span> https <span class="nt">--save</span> /etc/pacman.d/mirrorlist
</code></pre></div></div>

<p>To continously refresh the mirrorlist we can create the file <code class="highlighter-rouge">/etc/pacman.d/hooks/mirrorupgrade.hook</code>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[Trigger]
Operation = Upgrade
Type = Package
Target = pacman-mirrorlist

[Action]
Description = Updating pacman-mirrorlist with reflector and removing pacnew...
When = PostTransaction
Depends = reflector
Exec = /bin/sh -c "reflector --country 'United Germany' --latest 50 --age 24 --sort rate --save /etc/pacman.d/mirrorlist; rm -f /etc/pacman.d/mirrorlist.pacnew"
</code></pre></div></div>

<p>Now we should set up our local domains, so we can things like <code class="highlighter-rouge">localhost</code>.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reflector <span class="nt">--verbose</span> <span class="nt">--latest</span> 50 <span class="nt">--sort</span> rate <span class="nt">--protocol</span> https <span class="nt">--save</span> /etc/pacman.d/mirrorlist
</code></pre></div></div>

<p>Also for compabilities sake it’s a good idea to enable 32-bit libraries. Do that by uncommenting  the<code class="highlighter-rouge">[multilib]</code> entry in <code class="highlighter-rouge">/etc/pacman.conf</code>.
To refresh the mirrorlist use <code class="highlighter-rouge">pacman -Sy</code>.</p>

<p>A root password is always a good idea. Create one by using <code class="highlighter-rouge">passwd</code>.</p>

<p>Create an initramfs that loads programs very early in the <code class="highlighter-rouge">userspace</code>.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkinitcpio <span class="nt">-p</span> linux
</code></pre></div></div>
<p>Now we need to install a boot loader. If you use UEFI you can do the following after installing it with <code class="highlighter-rouge">pacman -S grub</code>.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>grub-install <span class="nt">--target</span><span class="o">=</span>x86_64-efi <span class="nt">--efi-directory</span><span class="o">=</span>/boot <span class="nt">--bootloader-id</span><span class="o">=</span>grub
grub-mkconfig <span class="nt">-o</span> /boot/grub/grub.cfg
</code></pre></div></div>

<p>Now we can create a non-root user and add him to any group for example <code class="highlighter-rouge">wheel</code> and <code class="highlighter-rouge">audio</code>:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>useradd <span class="nt">-m</span> <span class="nt">-g</span> <span class="nb">users</span> <span class="nt">-s</span> /bin/bash alex
gpasswd <span class="nt">-a</span> alex wheel audio
</code></pre></div></div>

<p>Automatically set the system time:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl <span class="nb">enable</span> <span class="nt">--now</span> systemd-timesyncd.service
</code></pre></div></div>
<h2 id="step-3-moving-to-a-graphical-envirement">Step 3: Moving to a graphical envirement</h2>

<p>Now, as we have a layed down a solid foundation for our system we can move on by installing a window manager or a desktop environment to finally feel at home. For better performance install a sufficient driver. The open source drivers are <code class="highlighter-rouge">xf86-video-intel</code> for Intel, <code class="highlighter-rouge">xf86-video-amdgpu</code> for AMD and finally <code class="highlighter-rouge">xf86-video-nouveau</code> for Nvidia users.</p>

<p>If you don’t rely on any X depenend software, I’d recommend you to give <a href="https://swaywm.org/">sway</a> a try. Installing it via pacman will also install all important dependencies.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>pacman <span class="nt">-S</span> sway dmenu rxvt-unicode xorg-server-xwayland
</code></pre></div></div>

<p>You can start sway by adding it to the end of your <code class="highlighter-rouge">~/.bashrc</code>.</p>

<p>For further customization please refer to my <a href="https://github.com/alexanderstephan/dotfiles">dotfiles repo</a>.</p>

<p>I hope this was helpful!</p>


      </p>
    </div>
    

    

</section>

<section class="post">
  <header class="post-header">
    <p class="post-meta">
      <span class="post-date">
        22 OCT 2018
      </span>
      
      •
      
        <a class="post-cat" href="http://localhost:4000/categories/#tutorial">tutorial</a>
        
      
      
    </p>
    <h4>
      <a href="http://localhost:4000/articles/2018-10/gh60-on-linux" class="post-title" title="Programming a GH60 on Linux">Programming a GH60 on Linux</a>
      
    </h4>

    

    </header>

    
    <div class="post-description">
      <p>
        <p>I recently wanted to update my keyboards layout and thought it was a good opportunity to come with a guide since many friends keep asking me how to flash their keyboard on Linux. In this case I am requiring an Atmel-based PCB as we’re using DFU-Programmer which is developed for Atmel-Microcontrollers. But there is a good chance, that you have one in your keyboard as well since they are the most popular manufacturer for micro controllers.</p>

<p>Install prerequisites:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>pacman <span class="nt">-S</span> python python-pip python-wxpython  dfu-programmer
</code></pre></div></div>
<p>First of all we need to come up with our layout, which we use easykeymap.sh from the EasyAVR package for. It also generates a .hex file which we later use for flashing. In order to run easykeymap.sh we need to clone the project from GitLab.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://gitlab.com/ChuckN408/EasyAVR.git <span class="o">&amp;&amp;</span> <span class="nb">cd </span>EasyAVR
<span class="nb">sudo</span> ./easykeymap.sh
</code></pre></div></div>

<p>Firstly you need to create a new layout file and select your board accordingly. In my case it’s a GH60. There is also an option that lets you roughly determine the keyboard layout. In my case I selected ISO here as it’s the standard here in Europe. Now you can either further modify your selected layout in <code class="highlighter-rouge">easykeymapper</code> itself or use one from an external source. For example you can generate layout files online by using the [keyboard-layout-editor(https://keyboard-layout-editor.com).</p>

<p>To map the keys select the key you want to remap and click on the white rectangle beneath the scan code in the context menu. Now a virtual keyboard assists you in finding the correct key. In order to use function layers, you need to define a key as <code class="highlighter-rouge">Fn1</code>, <code class="highlighter-rouge">Fn0</code> will not work. If you finished your layout you can go ahead and save it now in .json format for later modifications.</p>

<p>Now you need to export the <code class="highlighter-rouge">.hex</code> file, that we will going to flash on to the keyboards microcontroller. To program your board you can either choose the “Build &amp; Program” option or use <code class="highlighter-rouge">dfu-programmer</code> manually. I prefer the by hand method for security reasons since it doesn’t require you to open <code class="highlighter-rouge">easykeymapper</code> as <code class="highlighter-rouge">root</code> user. But keep in mind that you first need to put your board into boot mode by either pressing a reset button at the back of your PCB or use a predefined boot button.</p>

<p>The programming steps are as follows. If you’re board uses a different microntroller than the atmega32u4 simply replace the name. But keep in mind you need to use a second keyboard to enter the commands. Alternatively you can use a <a href="https://gist.github.com/alexanderstephan/655e9fc4ab07f268af271c4084c19fef">script</a> as well.</p>

<p>Using the script:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget https://gist.githubusercontent.com/alexanderstephan/655e9fc4ab07f268af271c4084c19fef/raw/bee744308b81e524557fde6ad2890ba4a74414da/gh60.sh <span class="nt">-O</span> gh60.sh
<span class="nb">chmod</span> +x gh60.sh
<span class="nb">sudo</span> ./gh60.sh
</code></pre></div></div>
<p>Or just do it manually, if you only do it once in a while.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dfu-programmer atmega32u4 erase <span class="nt">--suppress-validation</span>
dfu-programmer atmega32u4 flash &lt;filename&gt;.hex
</code></pre></div></div>

      </p>
    </div>
    

    

</section>


        <footer>
  &copy; 2020 Alexander Stephan. Powered by <a href="http://jekyllrb.com/">Jekyll</a>, <a href="http://github.com/renyuanz/leonids/">leonids theme</a> made with <i class="fa fa-heart heart-icon"></i>
</footer>

      </div>
    </div>
  </div>
</body>
</html>
